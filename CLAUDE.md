# quickjs-emscripten

## Package Manager

Use `corepack yarn` to run yarn commands, e.g.:

- `corepack yarn install`
- `corepack yarn build`
- `corepack yarn build:ts`

## Building Variants

Variants are WASM/JS builds of QuickJS with different configurations. They are generated by `scripts/prepareVariants.ts`.

To build a variant:

```bash
cd packages/variant-quickjs-<name>
make           # builds the C code with emscripten
corepack yarn build:ts  # builds the TypeScript wrapper
```

## Emscripten

- Most variants use the default emscripten version (defined in `scripts/prepareVariants.ts` as `DEFAULT_EMSCRIPTEN_VERSION`)
- The asmjs variant uses an older emscripten version (`ASMJS_EMSCRIPTEN_VERSION`) to avoid newer browser APIs
- Emscripten runs via Docker when the local version doesn't match; see `scripts/emcc.sh`

## Key Files

- `scripts/prepareVariants.ts` - Generates all variant packages from templates
- `scripts/generate.ts` - Generates FFI bindings and symbols
- `templates/Variant.mk` - Makefile template for variants
- `c/interface.c` - C interface to QuickJS exposed to JavaScript
